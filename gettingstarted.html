<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ZAD Maps</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="css/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <style>
        </style>
        
    </head>
    <body>
      <header class="u-clearfix">
          <div class="logo">
            <a href="" target="_blank" rel="noopener">
              <h2>ZAD Maps</h2>
            </a>
          </div>
          <div class="release-notes">
            <p>Version 0.0.1</p>
          </div>
      </header>
      <br/>
      <div class="button-container">
        <div class="btn-group">
          <button class="button active" value="Province">Province</button>
          <button class="button" value="District">Districts Municipalities</button>
          <button class="button" value="Local">Local Municipalities</button>
          <button class="button" value="Wards">Wards</button>
        </div>
      </div>
      
      <!-- Raphael Maps -->
      <main>
        <!-- Data Driven Documents (D3)-->
        <svg width="960" height="700"></svg>
      </main>


      <script src="js/jquery.min.js" type="text/javascript"></script>
      <script src="js/raphael.min.js" type="text/javascript"></script>
      <script src="js/d3.min.js" type="text/javascript"></script>
      <script src="js/topojson.v2.min.js" type="text/javascript"></script>
      <script src="js/maps.js" type="text/javascript"></script>
      <script type="text/javascript">

        function district(){


          var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

          var projection = d3.geoAlbers()
            .center([24.7, -29.2])
            .rotate([0, 0, 12])
            .parallels([-22.1, -34.1])
            .scale(3000)
            .translate([200, 600]);

          var path = d3.geoPath()
            .projection(projection);

          var color = d3.scaleThreshold()
            .domain(d3.range(2, 10))
            .range(d3.schemeBlues[9]);

          var colors = {
            "Northern Cape": "#64B5F6", 
            "Mpumalanga":"#4DD0E1", 
            "KwaZulu-Natal":"#81C784",
            "Western Cape": "#BA68C8",
            "Free State": "#DCE775",
            "North West": "#FFF176",
            "Gauteng": "#F06292",
            "Limpopo": "#E57373",
            "Eastern Cape": "#FFB74D"
          }

          var data_points = {
            "Northern Cape": 253, 
            "Mpumalanga": 550, 
            "KwaZulu-Natal": 800,
            "Western Cape": 600,
            "Free State": 563,
            "North West": 234,
            "Gauteng":  223,
            "Limpopo": 123,
            "Eastern Cape": 12
          }

          var tooltip = d3.select('body')
            .append('div')
            .attr('class', 'tooltip')
            .style('opacity', 0);

          var promises = [d3.json("geojson/za-districts.topojson"),]

          Promise.all(promises).then(ready)

          // STRARTS HERE
          function ready([data]){

            console.log(data);
            console.log(topojson.feature(data, data.objects.layer1).features);

            svg.append("g")
                .attr("class", "layer1")
              .selectAll("path")
              .data(topojson.feature(data, data.objects.layer1).features)

              .enter().append("path")
                .attr("fill", d => '#19865C')//'#19865C')colors[d.properties.PROVINCE]
                .attr("d", path)
                .on('mouseover', function(d){
                    //console.log(d);
                    tooltip.transition()
                      .duration(200)
                      .style('opacity', 0.9);

                    tooltip.html('<b>' + d.properties.MUNICNAME  + '</b><hr/>' + 'Number of people : ' + d.properties.PROVINCE)//data_points[d.properties.MAP_TITLE])
                      .style('left', d3.event.pageX + 'px')
                      .style('top', d3.event.pageY - 28 +'px');
                  })
                .on('mouseout', () => {
                  tooltip.transition()
                    .duration(500)
                    .style('opacity', 0);
                });

            svg.append("path")
                .datum(topojson.mesh(data, data.arcs, (a, b) => a !== b))//objects.layer1
                .attr("class", "province")
                .attr("stroke-width", '10px')
                .attr("d", path);

          }

        }

        function raphael_maps(){
          /*$.getJSON("geojson/map_data.json", function( data ){
              var paper = Raphael(0, 0, 2000, 2000);
              var elementSet = paper.set();
              var attrs = {"type":"path","stroke":"none"};
              var sa = {}

              $.each(data, function(i, province) {
                  console.log(province, i);
                  attrs.fill = province.color;
                  sa[province.name] = paper.path(province.path).attr(attrs);
                  sa[province.name].name = province.name;
              });

              $.each(sa, function(i, st) {
                  st.node.onclick = function() {
                      paper.clear();
                      var filename = "geojson/" + st.name.toLowerCase().replace(" ", "") + ".json";
                      var map_shapes = {
                          "Gauteng": {"transform": "s4.5,4.5 0,0", "paper": Raphael(-2200, -500, 3000, 2000)},
                          "Limpopo": {"transform": "s3,3 0,0", "paper": Raphael(-1400, 100, 3000, 2000)},
                          "Free State": {"transform": "s3,3 0,0", "paper": Raphael(-900, -500, 3000, 2000)},
                          "Northern Cape": {"transform": "s2,2 0,0", "paper": Raphael(100, -200, 3000, 2000)},
                          "Mpumalanga": {"transform": "s4,4 0,0", "paper": Raphael(-2100, -200, 3000, 2000)},
                          "Western Cape": {"transform": "s2.5,2.5 0,0", "paper": Raphael(0, -850, 3000, 2000)},
                          "KwaZulu Natal": {"transform": "s2.5,2.5 0,0", "paper": Raphael(-1400, -500, 3000, 2000)},
                          "Eastern Cape": {"tranform": "s2,2 0,0", "paper": Raphael(0, 0, 3000, 2000)},
                          "North West": {"transform": "s2.5,2.5 0,0", "paper": Raphael(-600, -200, 3000, 2000)}
                      }

                      var attrs = {"type":"path","stroke":"none"};
                      var sa = {};
                      var provinces = map_shapes[st.name].paper.set();

                      $.getJSON( filename, function( data ) {
                              $.each(data, function(i, munic) {
                                  attrs.fill = munic.color;
                                  sa[munic.name] = map_shapes[munic.province].paper.path(munic.path).attr(attrs);
                                  provinces.push(sa[munic.name]);
                                  sa[munic.name].name = munic.name;
                                  sa[munic.name].transform(map_shapes[munic.province].transform);
                             });
                      });
                  };
              });
          });*/
        }

        //province();
        //district();
        //municipalities();
        //wards();
      </script>
    </body>
</html>

    	
        
